{"version":3,"sources":["gchart_renderers.coffee"],"names":[],"mappings":"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","file":"gchart_renderers.js","sourceRoot":"/source/","sourcesContent":["callWithJQuery = (pivotModule) ->\n    if typeof exports is \"object\" and typeof module is \"object\" # CommonJS\n        pivotModule require(\"jquery\")\n    else if typeof define is \"function\" and define.amd # AMD\n        define [\"jquery\"], pivotModule\n    # Plain browser env\n    else\n        pivotModule jQuery\n\ncallWithJQuery ($) ->\n\n    makeGoogleChart = (chartType, extraOptions) -> (pivotData, opts) ->\n        defaults =\n            localeStrings:\n                vs: \"vs\"\n                by: \"by\"\n            gchart: {}\n\n        opts = $.extend(true, {}, defaults, opts)\n        opts.gchart.width ?= window.innerWidth / 1.4\n        opts.gchart.height ?= window.innerHeight / 1.4\n\n        rowKeys = pivotData.getRowKeys()\n        rowKeys.push [] if rowKeys.length == 0\n        colKeys = pivotData.getColKeys()\n        colKeys.push [] if colKeys.length == 0\n        fullAggName = pivotData.aggregatorName\n        if pivotData.valAttrs.length\n            fullAggName += \"(#{pivotData.valAttrs.join(\", \")})\"\n        headers = (h.join(\"-\") for h in rowKeys)\n        headers.unshift \"\"\n\n        numCharsInHAxis = 0\n        if chartType == \"ScatterChart\"\n            dataArray = []\n            for y, tree2 of pivotData.tree\n                for x, agg of tree2\n                     dataArray.push [\n                        parseFloat(x),\n                        parseFloat(y),\n                        fullAggName+\": \\n\"+agg.format(agg.value())\n                        ]\n            dataTable = new google.visualization.DataTable()\n            dataTable.addColumn 'number', pivotData.colAttrs.join(\"-\")\n            dataTable.addColumn 'number', pivotData.rowAttrs.join(\"-\")\n            dataTable.addColumn type: \"string\", role: \"tooltip\"\n            dataTable.addRows dataArray\n            hAxisTitle = pivotData.colAttrs.join(\"-\")\n            vAxisTitle = pivotData.rowAttrs.join(\"-\")\n            title = \"\"\n        else\n            dataArray = [headers]\n            for colKey in colKeys\n                row = [colKey.join(\"-\")]\n                numCharsInHAxis += row[0].length\n                for rowKey in rowKeys\n                    agg = pivotData.getAggregator(rowKey, colKey)\n                    if agg.value()?\n                        val = agg.value()\n                        if $.isNumeric val\n                            if val < 1\n                                row.push parseFloat(val.toPrecision(3))\n                            else\n                                row.push parseFloat(val.toFixed(3))\n                        else\n                            row.push val\n                    else row.push null\n                dataArray.push row\n\n            dataTable = google.visualization.arrayToDataTable(dataArray)\n\n            title = vAxisTitle = fullAggName\n            hAxisTitle = pivotData.colAttrs.join(\"-\")\n            title += \" #{opts.localeStrings.vs} #{hAxisTitle}\" if hAxisTitle != \"\"\n            groupByTitle = pivotData.rowAttrs.join(\"-\")\n            title += \" #{opts.localeStrings.by} #{groupByTitle}\" if groupByTitle != \"\"\n\n        options =\n            title: title\n            hAxis: {title: hAxisTitle, slantedText: numCharsInHAxis > 50}\n            vAxis: {title: vAxisTitle}\n            tooltip: { textStyle: { fontName: 'Arial', fontSize: 12 } }\n\n        if chartType == \"ColumnChart\"\n            options.vAxis.minValue = 0\n\n        if chartType == \"ScatterChart\"\n            options.legend = position: \"none\"\n            options.chartArea = {'width': '80%', 'height': '80%'}\n\n        else if dataArray[0].length == 2 and dataArray[0][1] ==  \"\"\n            options.legend = position: \"none\"\n\n        options = $.extend(true, {}, options, opts.gchart, extraOptions)\n\n        result = $(\"<div>\").css(width: \"100%\", height: \"100%\")\n        wrapper = new google.visualization.ChartWrapper {dataTable, chartType, options}\n        wrapper.draw(result[0])\n        result.bind \"dblclick\", ->\n            editor = new google.visualization.ChartEditor()\n            google.visualization.events.addListener editor, 'ok', ->\n                editor.getChartWrapper().draw(result[0])\n            editor.openDialog(wrapper)\n        return result\n\n    $.pivotUtilities.gchart_renderers =\n        \"Line Chart\": makeGoogleChart(\"LineChart\")\n        \"Bar Chart\": makeGoogleChart(\"ColumnChart\")\n        \"Stacked Bar Chart\": makeGoogleChart(\"ColumnChart\", isStacked: true)\n        \"Area Chart\": makeGoogleChart(\"AreaChart\", isStacked: true)\n        \"Scatter Chart\": makeGoogleChart(\"ScatterChart\")\n"]}